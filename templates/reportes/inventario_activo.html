{% extends "base.html" %}

{% block title %}Reporte | Inventario activo{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-4">
    <div>
        <h1 class="h3 mb-1">Reporte: Inventario activo</h1>
        <p class="text-muted mb-0">Equipos activos que no están dados de baja.</p>
    </div>
    {% if can_export %}
        <a class="btn btn-outline-primary" href="?{{ export_query }}">Exportar CSV</a>
    {% endif %}
</div>

<form method="get" class="card card-body mb-4 shadow-sm">
    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label">Sociedad</label>
            <select class="form-select" name="sociedad">
                <option value="">Todas</option>
                {% for sociedad_id, codigo, nombre in sociedades %}
                    {% if sociedad_id %}
                        <option value="{{ sociedad_id }}" {% if filtros.sociedad == sociedad_id|stringformat:"s" %}selected{% endif %}>
                            {{ codigo }} - {{ nombre }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">División</label>
            <select class="form-select" name="division">
                <option value="">Todas</option>
                {% for division_id, codigo, nombre in divisiones %}
                    {% if division_id %}
                        <option value="{{ division_id }}" {% if filtros.division == division_id|stringformat:"s" %}selected{% endif %}>
                            {{ codigo }} - {{ nombre }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">Centro de costo</label>
            <select class="form-select" name="centro_costo">
                <option value="">Todos</option>
                {% for centro_id, codigo, nombre in centros_costo %}
                    {% if centro_id %}
                        <option value="{{ centro_id }}" {% if filtros.centro_costo == centro_id|stringformat:"s" %}selected{% endif %}>
                            {{ codigo }} - {{ nombre }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Marca</label>
            <select class="form-select" name="marca">
                <option value="">Todas</option>
                {% for marca_id, nombre in marcas %}
                    {% if marca_id %}
                        <option value="{{ marca_id }}" {% if filtros.marca == marca_id|stringformat:"s" %}selected{% endif %}>
                            {{ nombre }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Sistema operativo</label>
            <select class="form-select" name="sistema_operativo">
                <option value="">Todos</option>
                {% for sistema_id, nombre in sistemas_operativos %}
                    {% if sistema_id %}
                        <option value="{{ sistema_id }}" {% if filtros.sistema_operativo == sistema_id|stringformat:"s" %}selected{% endif %}>
                            {{ nombre }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Tipo de equipo</label>
            <select class="form-select" name="tipo_equipo">
                <option value="">Todos</option>
                {% for tipo_id, nombre in tipos_equipo %}
                    {% if tipo_id %}
                        <option value="{{ tipo_id }}" {% if filtros.tipo_equipo == tipo_id|stringformat:"s" %}selected{% endif %}>
                            {{ nombre }}
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Texto libre</label>
            <input
                class="form-control"
                type="text"
                name="texto"
                value="{{ filtros.texto }}"
                placeholder="Inventario, serie o nombre"
            >
        </div>
    </div>
    <div class="mt-3 d-flex gap-2">
        <button type="submit" class="btn btn-primary">Aplicar filtros</button>
        <a class="btn btn-outline-secondary" href="{% url 'reporte_inventario_activo' %}">Limpiar</a>
    </div>
</form>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Identificador</th>
                        <th>Inventario</th>
                        <th>Serie</th>
                        <th>Nombre</th>
                        <th>Sociedad</th>
                        <th>División</th>
                        <th>Centro de costo</th>
                        <th>Marca</th>
                        <th>Sistema operativo</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for equipo in page_obj %}
                        <tr>
                            <td>{{ equipo.identificador }}</td>
                            <td>{{ equipo.numero_inventario }}</td>
                            <td>{{ equipo.numero_serie }}</td>
                            <td>{{ equipo.nombre }}</td>
                            <td>{{ equipo.centro_costo.division.sociedad }}</td>
                            <td>{{ equipo.centro_costo.division }}</td>
                            <td>{{ equipo.centro_costo }}</td>
                            <td>{{ equipo.marca|default:"-" }}</td>
                            <td>{{ equipo.sistema_operativo|default:"-" }}</td>
                            <td>{{ equipo.tipo_equipo|default:"-" }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="10" class="text-center text-muted py-4">
                                No se encontraron equipos con los filtros seleccionados.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% if page_obj.paginator.num_pages > 1 %}
    <nav class="mt-3">
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&{{ pagination_query }}">Anterior</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Anterior</span></li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ num }}&{{ pagination_query }}">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&{{ pagination_query }}">Siguiente</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
            {% endif %}
        </ul>
    </nav>
{% endif %}
{% endblock %}
