{% extends "base.html" %}

{% block title %}Detalle de equipo{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
    <div>
        <h1 class="h3 mb-1">{{ equipo.nombre }}</h1>
        <p class="text-muted mb-0">Identificador: {{ equipo.identificador }}</p>
    </div>
    <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{% url 'equipos_list' %}">Volver</a>
        {% if can_edit %}
            <a class="btn btn-primary" href="{% url 'equipo_edit' equipo.pk %}">Editar</a>
        {% endif %}
        {% if can_baja and not equipo.is_baja %}
            <a class="btn btn-danger" href="{% url 'equipo_baja' equipo.pk %}">Dar de baja</a>
        {% endif %}
    </div>
</div>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
{% endif %}

<div class="card mb-3">
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-4">Inventario</dt>
            <dd class="col-sm-8">{{ equipo.numero_inventario|default:"-" }}</dd>

            <dt class="col-sm-4">Clave</dt>
            <dd class="col-sm-8">{{ equipo.clave|default:"-" }}</dd>

            <dt class="col-sm-4">Número de serie</dt>
            <dd class="col-sm-8">{{ equipo.numero_serie }}</dd>

            <dt class="col-sm-4">Centro de costo</dt>
            <dd class="col-sm-8">
                {{ equipo.centro_costo.codigo }} - {{ equipo.centro_costo.nombre }}
            </dd>

            <dt class="col-sm-4">División</dt>
            <dd class="col-sm-8">{{ equipo.centro_costo.division.nombre }}</dd>

            <dt class="col-sm-4">Sociedad</dt>
            <dd class="col-sm-8">{{ equipo.centro_costo.division.sociedad.nombre }}</dd>

            <dt class="col-sm-4">Marca</dt>
            <dd class="col-sm-8">{{ equipo.marca|default:"-" }}</dd>

            <dt class="col-sm-4">Sistema operativo</dt>
            <dd class="col-sm-8">{{ equipo.sistema_operativo|default:"-" }}</dd>

            <dt class="col-sm-4">Tipo de equipo</dt>
            <dd class="col-sm-8">{{ equipo.tipo_equipo|default:"-" }}</dd>

            <dt class="col-sm-4">Modelo</dt>
            <dd class="col-sm-8">{{ equipo.modelo|default:"-" }}</dd>

            <dt class="col-sm-4">Dirección IP</dt>
            <dd class="col-sm-8">{{ equipo.direccion_ip|default:"-" }}</dd>

            <dt class="col-sm-4">Dirección MAC</dt>
            <dd class="col-sm-8">{{ equipo.direccion_mac|default:"-" }}</dd>

            <dt class="col-sm-4">Entidad</dt>
            <dd class="col-sm-8">{{ equipo.entidad|default:"-" }}</dd>

            <dt class="col-sm-4">Municipio</dt>
            <dd class="col-sm-8">{{ equipo.municipio|default:"-" }}</dd>

            <dt class="col-sm-4">Domicilio</dt>
            <dd class="col-sm-8">{{ equipo.domicilio|default:"-" }}</dd>

            <dt class="col-sm-4">Código postal</dt>
            <dd class="col-sm-8">{{ equipo.codigo_postal|default:"-" }}</dd>

            <dt class="col-sm-4">Antigüedad</dt>
            <dd class="col-sm-8">{{ equipo.antiguedad|default:"-" }}</dd>

            <dt class="col-sm-4">RPE responsable</dt>
            <dd class="col-sm-8">{{ equipo.rpe_responsable|default:"-" }}</dd>

            <dt class="col-sm-4">Nombre responsable</dt>
            <dd class="col-sm-8">{{ equipo.nombre_responsable|default:"-" }}</dd>

            <dt class="col-sm-4">Estado</dt>
            <dd class="col-sm-8">
                {% if equipo.is_baja %}
                    <span class="badge bg-danger">Baja</span>
                    {% if equipo.fecha_baja %}
                        <span class="text-muted ms-2">{{ equipo.fecha_baja|date:"d/m/Y H:i" }}</span>
                    {% endif %}
                {% else %}
                    <span class="badge bg-success">Activo</span>
                {% endif %}
            </dd>
        </dl>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="h5 mb-0">Historial de bajas</h2>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped mb-0 align-middle">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>Motivo</th>
                        <th>Usuario</th>
                        <th>Comentarios</th>
                    </tr>
                </thead>
                <tbody>
                    {% for baja in bajas %}
                        <tr>
                            <td>{{ baja.fecha_baja|date:"d/m/Y H:i" }}</td>
                            <td>{{ baja.get_tipo_baja_display }}</td>
                            <td>{{ baja.motivo|default:"-" }}</td>
                            <td>{{ baja.usuario.get_username|default:"-" }}</td>
                            <td>{{ baja.comentarios|default:"-" }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">
                                No hay bajas registradas para este equipo.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
